<?xml version="1.0" ?>
<server xmlns="urn:jboss:domain:4.2">
	<extensions>
		<extension module="org.jboss.as.deployment-scanner"/>
		<extension module="org.jboss.as.ee"/>
		<extension module="org.jboss.as.jmx"/>
		<extension module="org.jboss.as.logging"/>
		<extension module="org.jboss.as.naming"/>
		<extension module="org.jboss.as.security"/>
		<extension module="org.wildfly.extension.io"/>
		<extension module="org.wildfly.extension.request-controller"/>
		<extension module="org.wildfly.extension.security.manager"/>
		<extension module="org.wildfly.extension.undertow"/>
	</extensions>
	<management>
		<security-realms>
			<security-realm name="ManagementRealm">
				<authentication>
					<local default-user="$local"/>
					<properties path="mgmt-users.properties" relative-to="jboss.server.config.dir"/>
				</authentication>
				<authorization map-groups-to-roles="false">
					<properties path="mgmt-groups.properties" relative-to="jboss.server.config.dir"/>
				</authorization>
			</security-realm>
			<security-realm name="ApplicationRealm">
				<server-identities>
					<ssl>
						<keystore path="application.keystore" relative-to="jboss.server.config.dir" keystore-password="password" alias="server" key-password="password" generate-self-signed-certificate-host="localhost"/>
					</ssl>
				</server-identities>
				<authentication>
					<local default-user="$local" allowed-users="*"/>
					<properties path="application-users.properties" relative-to="jboss.server.config.dir"/>
				</authentication>
				<authorization>
					<properties path="application-roles.properties" relative-to="jboss.server.config.dir"/>
				</authorization>
			</security-realm>
		</security-realms>
		<audit-log>
			<formatters>
				<json-formatter name="json-formatter"/>
			</formatters>
			<handlers>
				<file-handler name="file" formatter="json-formatter" path="/home/dockeri/logs/audit-log.log" />
			</handlers>
			<logger log-boot="true" log-read-only="false" enabled="false">
				<handlers>
					<handler name="file"/>
				</handlers>
			</logger>
		</audit-log>
		<management-interfaces>
			<http-interface security-realm="ManagementRealm" http-upgrade-enabled="true">
				<socket-binding http="management-http"/>
			</http-interface>
		</management-interfaces>
		<access-control provider="simple">
			<role-mapping>
				<role name="SuperUser">
					<include>
						<user name="$local"/>
					</include>
				</role>
			</role-mapping>
		</access-control>
	</management>
	<profile>
		<subsystem xmlns="urn:jboss:domain:logging:3.0">
			<console-handler name="CONSOLE">
				<level name="INFO"/>
				<formatter>
					<named-formatter name="COLOR-PATTERN"/>
				</formatter>
			</console-handler>
			<periodic-rotating-file-handler name="FILE" autoflush="true">
				<formatter>
					<named-formatter name="PATTERN"/>
				</formatter>
				<file path="/home/dockeri/logs/server.log"/>
				<suffix value=".yyyy-MM-dd"/>
				<append value="true"/>
			</periodic-rotating-file-handler>
			<size-rotating-file-handler name="LWI_LOG_MESSAGE" autoflush="true">
				<level name="INFO"/>
				<formatter>
					<pattern-formatter pattern="%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%E%n"/>
				</formatter>
				<file path="/home/dockeri/logs/lwi_audit.log"/>
				<rotate-size value="100M"/>
				<max-backup-index value="10"/>
				<append value="true"/>
				<suffix value=".yyyy-MM-dd"/>
			</size-rotating-file-handler>
			<size-rotating-file-handler name="LWI_SEPARATE" autoflush="true">
				<level name="INFO"/>
				<formatter>
					<pattern-formatter pattern="%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%E%n"/>
				</formatter>
				<file path="/home/dockeri/logs/lwi_app.log"/>
				<rotate-size value="100M"/>
				<max-backup-index value="10"/>
				<append value="true"/>
				<suffix value=".yyyy-MM-dd"/>
			</size-rotating-file-handler>
			<logger category="hu.telekom.lwi" use-parent-handlers="true">
				<level name="DEBUG"/>
				<handlers>
					<handler name="LWI_SEPARATE"/>
				</handlers>
			</logger>
			<logger category="LWI_LOG_MESSAGE" use-parent-handlers="false">
				<level name="DEBUG"/>
				<handlers>
					<handler name="LWI_LOG_MESSAGE"/>
				</handlers>
			</logger>
			<logger category="com.arjuna">
				<level name="WARN"/>
			</logger>
			<logger category="org.jboss.as.config">
				<level name="DEBUG"/>
			</logger>
			<logger category="sun.rmi">
				<level name="WARN"/>
			</logger>
			<root-logger>
				<level name="INFO"/>
				<handlers>
					<handler name="CONSOLE"/>
					<handler name="FILE"/>
				</handlers>
			</root-logger>
			<formatter name="PATTERN">
				<pattern-formatter pattern="%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"/>
			</formatter>
			<formatter name="COLOR-PATTERN">
				<pattern-formatter pattern="%K{level}%d{HH:mm:ss,SSS} %-5p [%c] (%t) %s%e%n"/>
			</formatter>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:deployment-scanner:2.0">
			<deployment-scanner path="deployments" relative-to="jboss.server.base.dir" scan-interval="5000" runtime-failure-causes-rollback="${jboss.deployment.scanner.rollback.on.failure:false}"/>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:ee:4.0">
			<spec-descriptor-property-replacement>false</spec-descriptor-property-replacement>
			<concurrent>
				<context-services>
					<context-service name="default" jndi-name="java:jboss/ee/concurrency/context/default" use-transaction-setup-provider="false"/>
				</context-services>
				<managed-thread-factories>
					<managed-thread-factory name="default" jndi-name="java:jboss/ee/concurrency/factory/default" context-service="default"/>
				</managed-thread-factories>
				<managed-executor-services>
					<managed-executor-service name="default" jndi-name="java:jboss/ee/concurrency/executor/default" context-service="default" hung-task-threshold="60000" keepalive-time="5000"/>
				</managed-executor-services>
				<managed-scheduled-executor-services>
					<managed-scheduled-executor-service name="default" jndi-name="java:jboss/ee/concurrency/scheduler/default" context-service="default" hung-task-threshold="60000" keepalive-time="3000"/>
				</managed-scheduled-executor-services>
			</concurrent>
			<default-bindings context-service="java:jboss/ee/concurrency/context/default" managed-executor-service="java:jboss/ee/concurrency/executor/default" managed-scheduled-executor-service="java:jboss/ee/concurrency/scheduler/default" managed-thread-factory="java:jboss/ee/concurrency/factory/default"/>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:io:1.1">
			<worker name="default"/>
			<buffer-pool name="default"/>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:jmx:1.3">
			<expose-resolved-model/>
			<expose-expression-model/>
			<remoting-connector/>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:naming:2.0"/>
		<subsystem xmlns="urn:jboss:domain:request-controller:1.0"/>
		<subsystem xmlns="urn:jboss:domain:security:1.2">
			<security-domains>
				<security-domain name="other" cache-type="default">
					<authentication>
						<login-module code="Remoting" flag="optional">
							<module-option name="password-stacking" value="useFirstPass"/>
						</login-module>
						<login-module code="RealmDirect" flag="required">
							<module-option name="password-stacking" value="useFirstPass"/>
						</login-module>
					</authentication>
				</security-domain>
			</security-domains>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:security-manager:1.0">
			<deployment-permissions>
				<maximum-set>
					<permission class="java.security.AllPermission"/>
				</maximum-set>
			</deployment-permissions>
		</subsystem>
		<subsystem xmlns="urn:jboss:domain:undertow:3.1">
			<buffer-cache name="default"/>
			<server name="default-server">
				<http-listener name="default" socket-binding="http" redirect-socket="https" enable-http2="true"/>
				<https-listener name="https" socket-binding="https" security-realm="ApplicationRealm" enable-http2="true"/>
				<host name="default-host" alias="localhost">
					<location name="/" handler="welcome-content"/>
					<!-- CNR getMsisdn -->
					<location   name="/lwi/cnr/getMsisdn" handler="lwi-cnr-getMsisdn-pro"/>
					<filter-ref name="lwi-cnr-getMsisdn" predicate="path-prefix('/lwi/cnr/getMsisdn')"/>
					<filter-ref name="lwi-cnr-getMsisdn-req"  predicate="path-prefix('/lwi/cnr/getMsisdn')"/>
					<filter-ref name="lwi-cnr-getMsisdn-seq" predicate="path-prefix('/lwi/cnr/getMsisdn')"/>
					<filter-ref name="lwi-cnr-getMsisdn-val" predicate="path-prefix('/lwi/cnr/getMsisdn')"/>
					<filter-ref name="lwi-cnr-getMsisdn-log" predicate="path-prefix('/lwi/cnr/getMsisdn')"/>
					<!--  eStore QueryProducedDocumentList  -->
					<location   name="/lwi/estore/qpdl" handler="lwi-estore-qpdl-pro"/>
					<filter-ref name="lwi-estore-qpdl" predicate="path-prefix('/lwi/estore/qpdl')"/>
					<filter-ref name="lwi-estore-qpdl-req"  predicate="path-prefix('/lwi/estore/qpdl')"/>
					<filter-ref name="lwi-estore-qpdl-seq" predicate="path-prefix('/lwi/estore/qpdl')"/>
					<filter-ref name="lwi-estore-qpdl-val" predicate="path-prefix('/lwi/estore/qpdl')"/>
					<filter-ref name="lwi-estore-qpdl-log" predicate="path-prefix('/lwi/estore/qpdl')"/>
					<!--  eStore getDocument  -->
					<location   name="/lwi/estore/getDocument" handler="lwi-estore-getDocument-pro"/>
					<filter-ref name="lwi-estore-getDocument" predicate="path-prefix('/lwi/estore/getDocument')"/>
					<filter-ref name="lwi-estore-getDocument-req"  predicate="path-prefix('/lwi/estore/getDocument')"/>
					<filter-ref name="lwi-estore-getDocument-seq" predicate="path-prefix('/lwi/estore/getDocument')"/>
					<filter-ref name="lwi-estore-getDocument-val" predicate="path-prefix('/lwi/estore/getDocument')"/>
					<filter-ref name="lwi-estore-getDocument-log" predicate="path-prefix('/lwi/estore/getDocument')"/>
					<!-- LWITEST hello -->
					<location   name="/lwi/lwitest/hello" handler="lwi-lwitest-hello-pro"/>
					<filter-ref name="lwi-lwitest-hello" predicate="path-prefix('/lwi/lwitest/hello')"/>
					<filter-ref name="lwi-lwitest-hello-req"  predicate="path-prefix('/lwi/lwitest/hello')"/>
					<filter-ref name="lwi-lwitest-hello-seq" predicate="path-prefix('/lwi/lwitest/hello')"/>
					<filter-ref name="lwi-lwitest-hello-val" predicate="path-prefix('/lwi/lwitest/hello')"/>
					<filter-ref name="lwi-lwitest-hello-log" predicate="path-prefix('/lwi/lwitest/hello')"/>
				</host>
			</server>
			<servlet-container name="default">
				<jsp-config/>
				<websockets/>
			</servlet-container>
			<handlers>
				<file name="welcome-content" path="${jboss.home.dir}/welcome-content"/>
				<!-- CNR getMsisdn -->
				<reverse-proxy name="lwi-cnr-getMsisdn-pro" max-request-time="30000" connections-per-thread="2">
					<host name="cnr-server1" outbound-socket-binding="cnr-server" path="/LwiMockTargets/GetMsisdn" instance-id="cnr-server-route1"/>
				</reverse-proxy>
				<!--  eStore QueryProducedDocumentList  -->
				<reverse-proxy name="lwi-estore-qpdl-pro" max-request-time="30000" connections-per-thread="2">
					<host name="estore-server1" outbound-socket-binding="estore-server" path="/LwiMockTargets/Qpdl" instance-id="estore-server-route1"/>
				</reverse-proxy>
				<!--  eStore getDocument  -->
				<reverse-proxy name="lwi-estore-getDocument-pro" max-request-time="30000" connections-per-thread="2">
					<host name="estore-server2" outbound-socket-binding="estore-server" path="/LwiMockTargets/GetDocument" instance-id="estore-server-route2"/>
				</reverse-proxy>
				<!--  witets getDocument  -->
				<reverse-proxy name="lwi-lwitest-hello-pro" max-request-time="30000" connections-per-thread="2">
					<host name="lwitest-server1" outbound-socket-binding="lwitest-server" path="/LwiMockTargets/SayHello" instance-id="lwitest-server-route1"/>
				</reverse-proxy>
			</handlers>
			<filters>
				<!-- CNR getMsisdn -->
				<filter name="lwi-cnr-getMsisdn" class-name="hu.telekom.lwi.plugin.LwiHandler" module="hu.telekom.lwi">
					<param name="maxRequests" value="20"/>
					<param name="queueSize" value="10"/>
					<param name="logLevel" value="FULL"/>
					<param name="validationType" value="CTX"/>
					<param name="skipAuthentication" value="true"/>
					<param name="backEndServiceUrl" value="http://localhost:8091/LwiMockTargets/GetMsisdn"/>
					<param name="backEndConnections" value="10"/>
					<param name="requestTimeout" value="20000"/>
				</filter>
				<request-limit name="lwi-cnr-getMsisdn-req" max-concurrent-requests="3" queue-size="1"/>
				<filter name="lwi-cnr-getMsisdn-seq" module="hu.telekom.lwi" class-name="hu.telekom.lwi.plugin.security.LwiSecurityHandler"/>
				<filter name="lwi-cnr-getMsisdn-val" class-name="hu.telekom.lwi.plugin.validation.ValidationHandler" module="hu.telekom.lwi">
					<param name="validationType" value="CTX"/>
					<param name="wsdlLocation" value="wsdl"/>
				</filter>
				<filter name="lwi-cnr-getMsisdn-log" class-name="hu.telekom.lwi.plugin.log.LwiLogHandler" module="hu.telekom.lwi">
					<param name="logLevel" value="FULL"/>
				</filter>
				<!--  eStore QueryProducedDocumentList  -->
				<filter name="lwi-estore-qpdl" class-name="hu.telekom.lwi.plugin.LwiHandler" module="hu.telekom.lwi">
					<param name="maxRequests" value="20"/>
					<param name="queueSize" value="10"/>
					<param name="logLevel" value="FULL"/>
					<param name="validationType" value="CTX"/>
					<param name="skipAuthentication" value="true"/>
					<param name="backEndServiceUrl" value="http://localhost:8091/LwiMockTargets/Qpdl"/>
					<param name="backEndConnections" value="10"/>
					<param name="requestTimeout" value="20000"/>
				</filter>
				<request-limit name="lwi-estore-qpdl-req" max-concurrent-requests="3" queue-size="1"/>
				<filter name="lwi-estore-qpdl-seq" module="hu.telekom.lwi" class-name="hu.telekom.lwi.plugin.security.LwiSecurityHandler"/>
				<filter name="lwi-estore-qpdl-val" class-name="hu.telekom.lwi.plugin.validation.ValidationHandler" module="hu.telekom.lwi">
					<param name="validationType" value="CTX"/>
					<param name="wsdlLocation" value="wsdl"/>
				</filter>
				<filter name="lwi-estore-qpdl-log" class-name="hu.telekom.lwi.plugin.log.LwiLogHandler" module="hu.telekom.lwi">
					<param name="logLevel" value="FULL"/>
				</filter>
				<!--  eStore QueryProducedDocumentList  -->
				<filter name="lwi-estore-getDocument" class-name="hu.telekom.lwi.plugin.LwiHandler" module="hu.telekom.lwi">
					<param name="maxRequests" value="20"/>
					<param name="queueSize" value="10"/>
					<param name="logLevel" value="MIN"/>
					<param name="validationType" value="NO"/>
					<param name="skipAuthentication" value="true"/>
					<param name="backEndServiceUrl" value="http://localhost:8091/LwiMockTargets/GetDocument"/>
					<param name="backEndConnections" value="10"/>
					<param name="requestTimeout" value="20000"/>
				</filter>
				<request-limit name="lwi-estore-getDocument-req" max-concurrent-requests="3" queue-size="1"/>
				<filter name="lwi-estore-getDocument-seq" module="hu.telekom.lwi" class-name="hu.telekom.lwi.plugin.security.LwiSecurityHandler"/>
				<filter name="lwi-estore-getDocument-val" class-name="hu.telekom.lwi.plugin.validation.ValidationHandler" module="hu.telekom.lwi">
					<param name="validationType" value="NO"/>
					<param name="wsdlLocation" value="wsdl"/>
				</filter>
				<filter name="lwi-estore-getDocument-log" class-name="hu.telekom.lwi.plugin.log.LwiLogHandler" module="hu.telekom.lwi">
					<param name="logLevel" value="MIN"/>
				</filter>
				<!--  LWITEST SayHEllo -->
				<filter name="lwi-lwitest-hello" class-name="hu.telekom.lwi.plugin.LwiHandler" module="hu.telekom.lwi">
					<param name="maxRequests" value="20"/>
					<param name="queueSize" value="10"/>
					<param name="logLevel" value="FULL"/>
					<param name="validationType" value="CTX"/>
					<param name="skipAuthentication" value="true"/>
					<param name="backEndServiceUrl" value="http://localhost:8091/LwiMockTargets/SayHello"/>
					<param name="backEndConnections" value="10"/>
					<param name="requestTimeout" value="20000"/>
				</filter>
				<request-limit name="lwi-lwitest-hello-req" max-concurrent-requests="3" queue-size="1"/>
				<filter name="lwi-lwitest-hello-seq" module="hu.telekom.lwi" class-name="hu.telekom.lwi.plugin.security.LwiSecurityHandler"/>
				<filter name="lwi-lwitest-hello-val" class-name="hu.telekom.lwi.plugin.validation.ValidationHandler" module="hu.telekom.lwi">
					<param name="validationType" value="CTX"/>
					<param name="wsdlLocation" value="wsdl"/>
				</filter>
				<filter name="lwi-lwitest-hello-log" class-name="hu.telekom.lwi.plugin.log.LwiLogHandler" module="hu.telekom.lwi">
					<param name="logLevel" value="FULL"/>
				</filter>
			</filters>
		</subsystem>
	</profile>
	<interfaces>
		<interface name="management">
			<any-address/>
		</interface>
		<interface name="public">
			<any-address/>
		</interface>
	</interfaces>
	<socket-binding-group name="standard-sockets" default-interface="public" port-offset="${jboss.socket.binding.port-offset:0}">
		<socket-binding name="management-http" interface="management" port="${jboss.management.http.port:9990}"/>
		<socket-binding name="management-https" interface="management" port="${jboss.management.https.port:9993}"/>
		<socket-binding name="ajp" port="${jboss.ajp.port:8009}"/>
		<socket-binding name="http" port="${jboss.http.port:8080}"/>
		<socket-binding name="https" port="${jboss.https.port:8443}"/>
		<!-- CNR server -->
		<outbound-socket-binding name="cnr-server">
			<remote-destination host="sumatra" port="8091"/>
		</outbound-socket-binding>
		<!-- eStore server -->
		<outbound-socket-binding name="estore-server">
			<remote-destination host="sumatra" port="8091"/>
		</outbound-socket-binding>
		<!-- LWITEST server -->
		<outbound-socket-binding name="lwitest-server">
			<remote-destination host="sumatra" port="8091"/>
		</outbound-socket-binding>
	</socket-binding-group>
</server>